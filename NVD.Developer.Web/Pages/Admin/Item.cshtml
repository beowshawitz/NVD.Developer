@page
@model NVD.Developer.Web.Pages.Admin.ItemModel
@{
	ViewData["Title"] = "Application Item";
}
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
	<symbol id="check-circle-fill" fill="currentColor" viewBox="0 0 16 16">
		<path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
	</symbol>
	<symbol id="info-fill" fill="currentColor" viewBox="0 0 16 16">
		<path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z" />
	</symbol>
	<symbol id="exclamation-triangle-fill" fill="currentColor" viewBox="0 0 16 16">
		<path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z" />
	</symbol>
	<symbol id="x-circle-fill" viewBox="0 0 16 16">
		<path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"></path>
	</symbol>
	<symbol id="circle-plus" viewBox="0 0 16 16">
		<path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16" />
		<path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" />
	</symbol>
</svg>
<div class="container">
	<div class="row justify-content-center">
		<div class="col-10">
			<p class="lead mt-3">
				The application details make a difference. The information collected in this form not only make the record complete, but the details makes the app look better too. Please provide as much information as you can.
			</p>
			<div class="card mt-5">
				<form method="post" enctype="multipart/form-data">
					<h5 class="card-header">Application Item Details</h5>
					<div class="card-body">
						<div asp-validation-summary="ModelOnly" class="text-danger"></div>
						<input type="hidden" asp-for="ApplicationItem.Id" />
						<input type="hidden" asp-for="ApplicationItem.DateCreated" />
						<input type="hidden" asp-for="ApplicationItem.DateUpdated" />
						<div class="row mb-3">
							<label asp-for="ApplicationItem.Name" class="col-3 col-form-label" title="Application's name"></label>
							<div class="col-9">
								<input asp-for="ApplicationItem.Name" class="form-control" />
								<span asp-validation-for="ApplicationItem.Name" class="text-danger"></span>
							</div>
						</div>
						<div class="row mb-3">
							<label asp-for="ApplicationItem.DisplayName" class="col-3 col-form-label" title="Application's display name"></label>
							<div class="col-9">
								<input asp-for="ApplicationItem.DisplayName" class="form-control" />
								<span asp-validation-for="ApplicationItem.DisplayName" class="text-danger"></span>
							</div>
						</div>
						<div class="row mb-3">
							<label asp-for="ApplicationItem.Description" class="col-3 col-form-label" title="Application's description"></label>
							<div class="col-9">
								<textarea asp-for="ApplicationItem.Description" class="form-control"></textarea>
								<span asp-validation-for="ApplicationItem.Description" class="text-danger"></span>
							</div>
						</div>
						<div class="row mb-3">
							<label asp-for="ApplicationItem.ImageData" class="col-3 col-form-label" title="Application's image data"></label>
							<div class="col-9">
								@if (Model.ApplicationItem.ImageData != null)
								{
									<img id="appImage" style="width:150px;height:150px; object-fit:cover" src="data:image/*;base64,@(Convert.ToBase64String(Model.ApplicationItem.ImageData))">
								}
								else
								{
									<img id="appImage" style="width:150px;height:150px; object-fit:cover" data-src="holder.js/150x150?text=No%20Image%20Selected" src="">
								}
								<input asp-for="ApplicationItem.ImageData" type="hidden" />
								<input type="file" accept=".png,.jpg,.jpeg,.gif,.tif" asp-for="AppImageData" class="form-control my-3"
									   onchange="document.getElementById('appImage').src = window.URL.createObjectURL(this.files[0])" />
								<span asp-validation-for="AppImageData" class="text-danger"></span>
								<div>
									<ul>
										<li>Image files types: <span class="badge text-bg-secondary">*.png</span> <span class="badge text-bg-secondary">*.jpg</span> <span class="badge text-bg-secondary">*.gif</span> <span class="badge text-bg-secondary">*.jpeg</span> <span class="badge text-bg-secondary">*.tif</span></li>
										<li>Image dimensions: <span class="badge text-bg-secondary">Height: <=1000px</span> <span class="badge text-bg-secondary">Width: <= 500px</span></li>
									</ul>
									<input id="clearAppImageBtn" type="button" class="btn btn-sm btn-danger my-1" value="Clear App Image" title="Click to clear the application icon image" />
								</div>
								<input asp-for="ClearAppImage" type="hidden" />
							</div>
						</div>
						<div class="row mb-3">
							<label asp-for="ApplicationItem.IsLicenseRequired" class="col-3 col-form-label"></label>
							<div class="col-9 d-flex align-items-center">
								<div class="form-check">
									<input asp-for="ApplicationItem.IsLicenseRequired" class="form-check-input" type="checkbox" />
									<label class="form-check-label" asp-for="ApplicationItem.IsLicenseRequired">
										Check to indicate a license is required.
									</label>
								</div>
							</div>
						</div>
						<div class="row mb-3">
							<label asp-for="ApplicationItem.Versions" class="col-3 col-form-label" title="Application's versions"></label>
							<div class="col-9">
								<div class="d-flex gap-2 mb-2">
									@foreach (var appVersion in Model.ApplicationItem.Versions.OrderByDescending(x => x.Name))
									{
										<span class="badge d-flex p-0 align-items-center text-primary-emphasis bg-primary-subtle rounded-pill">
											<span class="ps-2 versionName">@appVersion.Name</span>
											<input type="hidden" name="appId" value="@Model.ApplicationItem.Id" />
											<input type="hidden" name="versionId" value="@appVersion.Id" />
											<button type="button" class="btn btn-sm deleteVersion" title="Click to delete this version." data-bs-toggle="modal" data-bs-target="#removeVersionModal">
												<svg class="bi ms-1" width="16" height="16">
													<use xlink:href="#x-circle-fill"></use>
												</svg>
											</button>
										</span>
									}
								</div>
								@if (Model.ApplicationItem != null && Model.ApplicationItem.Id > 0)
								{
									<button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addVersionModal">
										<svg class="bi ms-1" width="16" height="16">
											<use xlink:href="#circle-plus"></use>
										</svg> Add a new version
									</button>
								}
							</div>
						</div>
					</div>
					<div class="card-footer d-flex">
						<div class="p-2 flex-grow-1">
							<input type="submit" value="Save" class="btn btn-primary" />
							<a href="/Admin" class="btn btn-secondary" title="Click to cancel">Cancel</a>
						</div>
						<div class="p-2">
							@if (Model.ApplicationItem != null && Model.ApplicationItem.Id > 0)
							{
								<button type="button" id="deleteAppBtn" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteAppModal">Delete</button>
							}
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
	<div class="modal fade" id="addVersionModal" tabindex="-1" aria-labelledby="addVersionModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<form method="post" asp-page-handler="AddVersion">
					<div class="modal-header">
						<h1 class="modal-title fs-5" id="addVersionModalLabel">Add A New Version</h1>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<input type="hidden" name="appId" value="@Model.ApplicationItem.Id" />
						<div class="mb-3">
							<label for="newVersionText" class="form-label">Enter a version number</label>
							<input type="text" id="newVersionText" name="newVersionText" class="form-control" placeholder="Enter a version number like '1.0'" aria-label="Enter a version number like '1.0'" />
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
						<button type="submit" class="btn btn-primary">Add</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<div class="modal fade" id="removeVersionModal" tabindex="-1" aria-labelledby="removeVersionModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<form method="post" asp-page-handler="RemoveVersion">
					<div class="modal-header">
						<h1 class="modal-title fs-5" id="removeVersionModalLabel">Remove A Version</h1>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<p>Are you sure you wish to remove this version?</p>
						<ul>
							<li>Application Name: @Model.ApplicationItem.DisplayName</li>
							<li>Version Name: <span id="modalVersionName"></span></li>
						</ul>
						<input type="hidden" name="appId" value="@Model.ApplicationItem.Id" />
						<input type="hidden" name="versionName" value="@Model.ApplicationItem.Id" />
						<input type="hidden" name="versionId" value="" />
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
						<button type="submit" class="btn btn-primary">Remove</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<div class="modal fade" id="deleteAppModal" tabindex="-1" aria-labelledby="deleteAppModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<form method="post" asp-page-handler="RemoveApplication">
					<div class="modal-header">
						<h1 class="modal-title fs-5" id="deleteAppModalLabel">Remove Application</h1>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<p>Are you sure you wish to permanently delete this application and all the references to it?</p>
						<ul>
							<li>Application Name: @Model.ApplicationItem.DisplayName</li>
						</ul>
						<input type="hidden" name="appId" value="@Model.ApplicationItem.Id" />
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
						<button type="submit" class="btn btn-danger">Delete</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<partial name="_toastPartial" />
@section Scripts {
	<script type="text/javascript" src="~/js/holder.js"></script>
	<partial name="_ValidationScriptsPartial" />
	<script type="text/javascript">
		$(document).ready(function () {
			$(".toast").toast('show');
			$(".deleteVersion").click(function () {
				$("#modalVersionName").text($(this).siblings(".versionName").text());
				$('#removeVersionModal input[name="versionId"]').val($(this).siblings('input[name="versionId"]').val());
				$('#removeVersionModal input[name="versionName"]').val($(this).siblings(".versionName").text());
			});
			$("#clearAppImageBtn").click(function () {
				$("#ClearAppImage").val("true");

				var $image = $("#appImage");
				$image.replaceWith(emptyProfileTemplate);
				Holder.run({
					images: document.getElementById('appImage')
				});
			});
		});
		const emptyProfileTemplate = () => `
																										<img id="appImage" style="width:350px;height:350px; object-fit:cover" data-src="holder.js/150x150?text=No%20Image%20Selected" src="">
																									`.trim();
	</script>
}
